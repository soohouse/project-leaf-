<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.leaf.board.mapper.IBoardMapper">

	<!-- BoardVO와 데이터베이스 컬럼명을 일치시켜주는 resultMap인 BoardMap 선언 -->
	<resultMap type="com.spring.leaf.board.command.BoardVO" id="BoardMap">
		<id property="boardNo" column="board_NO" />
		<result property="boardTitle" column="board_title" />
		<result property="boardWriter" column="board_writer" />
		<result property="boardContent" column="board_content" />
		<result property="boardDate" column="board_date" />
		<result property="boardViews" column="board_views" />
	</resultMap>
	
	<sql id="search">
		<if test="condition == 'title'">
			WHERE board_title LIKE concat('%', #{keyword}, '%')
		</if>
		<if test="condition == 'writer'">
			WHERE board_writer LIKE concat('%', #{keyword}, '%')
		</if>
		<if test="condition == 'date'">
			WHERE board_date LIKE concat('%', #{keyword}, '%')
		</if>
	</sql>
	
	<!-- 자유게시판 글 등록 INSERT 쿼리 -->
	<insert id="boardWrite">
		INSERT INTO board(board_title, board_writer, board_content)
		VALUES (#{boardTitle}, #{boardWriter}, #{boardContent})
	</insert>
	
	<!-- 자유게시판 글 목록 SELECT 쿼리 -->
	<select id="boardList" resultMap="BoardMap">
		SELECT * FROM
			(
			SELECT @ROWNUM:=@ROWNUM+1 AS rn, A.* FROM
				(
				SELECT * FROM board
				<include refid="search" />
				ORDER BY board_NO DESC
				) A,(SELECT @ROWNUM := 0)B
			) B
		<![CDATA[
		WHERE rn > (#{pageNum}-1) * #{cpp}
		AND rn <= #{pageNum} * #{cpp}
		]]>
	</select>
	
	<!-- 자유게시판 프로필 사진 불러오기 SELECT 쿼리 -->
	<select id="boardwriterProfile">
		SELECT user_NO,
			(
			SELECT answer_writer
			FROM answer
			WHERE answer_NO=#{answerNo}
			)
		FROM user
		WHERE user_ID = #{userID}	
	</select> 
	
	<!-- 자유게시판 총 게시글 수 -->
	<select id="getTotal" resultType="int">
		SELECT COUNT(*)
		FROM board
		<include refid="search" />
	</select>
	
	<!-- 자유게시판 조회수 notice_views--> 
	<update id="boardViews">
		UPDATE board
		SET board_views = board_views + 1
		WHERE Board_no = #{boardNo}
	</update>
	
	
	<!-- 자유게시판 글 상세보기 SELECT 쿼리 -->
	<select id="boardContent" resultMap="BoardMap">
		SELECT * FROM board
		WHERE board_NO=#{boardNo}
	</select>
	
	<!-- 자유게시판 글 수정하기 UPDATE 쿼리 -->
	<update id="boardModify">
		UPDATE board
		SET board_title=#{boardTitle}, board_content=#{boardContent}
		WHERE board_NO=#{boardNo}
	</update>
	
	<!-- 자유게시판 글 삭제하기 DELETE 쿼리 -->
	<delete id="boardDelete">
		DELETE FROM board
		WHERE board_NO=#{boardNo}
	</delete>
	
	
</mapper>